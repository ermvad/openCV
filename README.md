
# OpenCV Filters

OpenCV Filters — это интерактивный инструмент для обработки изображений с использованием библиотеки OpenCV. Доступен в двух версиях: настольное приложение на PyQt5 и веб-приложение на FastAPI. Позволяет применять различные фильтры и эффекты к изображениям через удобный интерфейс.

## Особенности

- Поддержка множества фильтров и эффектов (более 60 различных фильтров)
- Настройка параметров каждого фильтра в реальном времени
- Возможность комбинирования фильтров с накопительным эффектом
- Полный предпросмотр обработанного изображения
- Система логирования для отладки
- Сбор статистики использования в базе данных SQLite
- Возможность работы как на рабочем столе, так и через веб-интерфейс

## Структура проекта

```
opencv_filters/
│
├── main.py                 # Точка входа в настольное приложение
├── ui.py                   # Интерфейс пользователя (PyQt5)
├── filters.py              # Реализация всех фильтров
├── filter_manager.py       # Управление фильтрами (добавление, удаление, применение)
├── signals.py              # Сигналы для обновления UI
├── filter_category.py      # Категории фильтров
├── config.py               # Настройки приложения (тема, стили и т.д.)
├── logger.py               # Система логирования
├── stats_db.py             # Модуль статистики использования (aiosqlite)
├── web_app.py              # Веб-версия приложения (FastAPI)
├── run_web.py              # Скрипт для запуска веб-сервера
├── templates/              # HTML шаблоны для веб-версии
│   ├── index.html          # Главная страница веб-приложения
│   └── stats.html          # Страница статистики
├── static/                 
│   ├── styles.css          # Стили для веб-интерфейса
│   ├── script.js           # JS
│   └── placeholder.jpg     # Заглушка для изображения
├── uploads/                # Папка для загружаемых изображений
├── results/                # Папка для результатов обработки
├── logs/                   # Папка для хранения логов
└── README.md               # Документация
```

## Архитектура

### Настольное приложение
Построено на основе паттерна MVC (Model-View-Controller):
- **Модель**: `filter_manager.py` и `filters.py` - содержат логику обработки изображений
- **Представление**: `ui.py` - интерфейс пользователя на PyQt5
- **Контроллер**: `main.py` и обработчики событий в `ui.py`

### Веб-приложение
Построено с использованием FastAPI:
- **Модель**: `filters.py` - логика обработки изображений
- **Представление**: HTML-шаблоны в папке `templates/`
- **Контроллер**: `web_app.py` - маршруты и обработчики запросов

### Дополнительные компоненты
- `signals.py` - реализует механизм обновления интерфейса при изменении данных
- `filter_category.py` - содержит классификацию фильтров по категориям
- `config.py` - содержит настройки приложения и темы
- `logger.py` - система логирования для отладки и мониторинга
- `stats_db.py` - сбор и анализ статистики использования в SQLite

## Требования

### Общие
- Python 3.6 или выше
- OpenCV 4.x
- NumPy

### Для настольного приложения
- PyQt5

### Для веб-приложения
- FastAPI
- Uvicorn
- Jinja2
- aiosqlite
- python-multipart

## Установка
1. Создайте виртуальное окружение (рекомендуется):
   ```bash
   python -m venv venv
   source venv/bin/activate  # Linux/macOS
   venv\Scripts\activate     # Windows
   ```

2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

   Если файл requirements.txt отсутствует, установите зависимости вручную:
   ```bash
   # Для настольного приложения
   pip install opencv-python numpy PyQt5
   
   # Для веб-приложения
   pip install opencv-python numpy fastapi uvicorn jinja2 aiosqlite python-multipart pillow
   ```

## Запуск

### Настольное приложение
```bash
python main.py
```

### Веб-приложение
```bash
python run_web.py
```
или напрямую через uvicorn:
```bash
uvicorn web_app:app --reload
```

После запуска веб-приложение будет доступно по адресу: `http://localhost:8000`

## Использование

### Настольное приложение

#### Загрузка изображения
1. Нажмите кнопку "Загрузить изображение"
2. Выберите файл изображения (.png, .jpg, .jpeg, .bmp, .tiff)

#### Применение фильтров
1. Выберите категорию фильтра из списка слева
2. Выберите конкретный фильтр из выпадающего списка
3. Нажмите кнопку "Добавить выбранный фильтр"
4. Настройте параметры фильтра, если необходимо

#### Управление фильтрами
- Включайте/отключайте фильтры с помощью флажка "Активен"
- Изменяйте порядок фильтров, удаляя и добавляя их заново
- Удаляйте фильтры кнопкой "Удалить фильтр"
- Сбрасывайте все фильтры кнопкой "Сбросить все фильтры"

#### Сохранение результата
1. Нажмите кнопку "Сохранить результат"
2. Выберите место и имя файла для сохранения

### Веб-приложение

#### Загрузка изображения
1. Перетащите изображение в область загрузки или нажмите на нее для выбора файла

#### Применение фильтров
1. Выберите категорию фильтра из выпадающего списка
2. Выберите конкретный фильтр
3. Настройте параметры, если доступны
4. Нажмите кнопку "Применить фильтр"

#### Управление фильтрами
- Фильтры применяются накопительно — каждый новый фильтр применяется к результату предыдущих
- Очистите все фильтры кнопкой "Очистить все"
- Сравните результат с оригиналом кнопкой "Сравнить"

#### Сохранение результата
- Нажмите кнопку "Скачать результат" для сохранения обработанного изображения

#### Просмотр статистики
- Перейдите на страницу статистики по адресу `/stats` или через меню навигации
- Просматривайте информацию о наиболее популярных фильтрах и общем использовании приложения

## Категории фильтров

1. **Размытие и сглаживание** - Gaussian Blur, Median Blur, Bilateral Filter и др.
2. **Обнаружение краев и контуров** - Canny, Sobel, Laplacian и др.
3. **Цветовые преобразования** - Grayscale, Sepia, HSV conversion и др.
4. **Морфологические операции** - Erosion, Dilation, Opening, Closing и др.
5. **Геометрические преобразования** - Resize, Rotate, Flip и др.
6. **Улучшение изображения** - Gamma Correction, Brightness/Contrast и др.
7. **Сегментация и пороги** - Thresholding, Adaptive Threshold, Watershed и др.
8. **Выделение признаков** - SIFT, SURF, ORB descriptors и др.
9. **Пользовательские фильтры** - Cartoon effect, Pixelation, Vignette и др.

## Отладка и логирование

Система логирования автоматически сохраняет информацию о работе приложения в папку `logs/`. Логи содержат информацию о:

- Загрузке и сохранении изображений
- Применении фильтров
- Ошибках и исключениях
- Общей работе приложения

Для анализа ошибок проверьте последний файл в каталоге `logs/`.

## Статистика использования

Система статистики собирает и сохраняет информацию о:

- Количестве сессий пользователей
- Количестве обработанных изображений
- Популярности фильтров и их категорий
- Времени выполнения каждого фильтра
- Успешности применения фильтров
- Общей активности использования приложения

Данные сохраняются в базе данных SQLite (`stats.db`) и доступны для просмотра через веб-интерфейс на странице `/stats`.

## Настройка

### Настройка темы
- Для настольного приложения: измените переменную `DARK_STYLE` в файле `config.py`
- Для веб-приложения: отредактируйте файл `static/styles.css`

### Добавление новых фильтров
Для добавления нового фильтра:

1. Создайте функцию фильтра в `filters.py`
2. Для настольного приложения: добавьте фильтр в соответствующую категорию в `ui.py` (метод `populate_filters`)
3. Для веб-приложения: добавьте фильтр в соответствующую категорию в `web_app.py` (функция `get_all_filters`)
4. Добавьте логику обработки параметров фильтра в функции `apply_filter`
